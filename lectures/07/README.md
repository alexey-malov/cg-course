# Программирование с использованием шейдеров

- [Программирование с использованием шейдеров](#программирование-с-использованием-шейдеров)
  - [Передача параметров в шейдерную программу](#передача-параметров-в-шейдерную-программу)
    - [Общая концепция](#общая-концепция)
    - [`uniform`-переменные](#uniform-переменные)
    - [Атрибутивные переменные (`attribute`) / `in`](#атрибутивные-переменные-attribute--in)
    - [Передача данных между шейдерами](#передача-данных-между-шейдерами)
    - [Работа с текстурами](#работа-с-текстурами)
    - [Примеры шейдеров](#примеры-шейдеров)
    - [Язык шейдеров GLSL](#язык-шейдеров-glsl)
    - [Особенности и ограничения GLSL](#особенности-и-ограничения-glsl)
    - [Заключение](#заключение)

## Передача параметров в шейдерную программу

Это краткое содержание лекции. [Смотреть полное видео на Youtube](https://youtu.be/j2XJBe4HMhk?si=P7yJd1k9tUZwLM4d)

### Общая концепция

- Шейдеры — это программы, исполняемые на GPU как часть графического конвейера OpenGL.
- Они компилируются драйвером и загружаются в видеокарту.
- Взаимодействие с шейдерами осуществляется через передачу параметров из программы на CPU в код на GPU.
- Для этого используются переменные следующих типов: `uniform`, `attribute` (устаревшее название), `in`, `out`, `sampler`.

---

### `uniform`-переменные

- `uniform`-переменные используются для передачи неизменяемых значений, общих для всех вершин/фрагментов в одном вызове отрисовки.
- Часто применяются для передачи:

  - координат центра фигур,
  - цвета,
  - параметров трансформации (матрицы),
  - времени и т.д.
- Получение позиции переменной:

  ```cpp
  GLint location = glGetUniformLocation(program, "someUniform");
  ```

- Передача значения:

  ```cpp
  glUniform1f(location, value);
  ```

- Начиная с OpenGL 4.3 (2014), можно явно указывать `layout(location = N)` в коде шейдера.

---

### Атрибутивные переменные (`attribute`) / `in`

- `attribute` — устаревший термин из старых версий GLSL. В современном GLSL (с версии 1.30 и выше) используется `in` во **вершинных шейдерах**.
- Эти переменные используются для передачи данных, связанных с конкретными вершинами:

  - позиции,
  - нормали,
  - цвета,
  - текстурных координат.
- Получение локейшена:

  ```cpp
  GLint loc = glGetAttribLocation(program, "vertexColor");
  ```

- Настройка передачи данных:

  ```cpp
  glEnableVertexAttribArray(loc);
  glVertexAttribPointer(loc, 3, GL_FLOAT, GL_FALSE, stride, offset);
  ```

---

### Передача данных между шейдерами

- Для связи между вершинным и фрагментным шейдерами используются переменные `varying` (в GLSL до 1.30) или `out`/`in` (начиная с GLSL 1.30).
- Пример:

  ```glsl
  // Вершинный шейдер
  out vec3 fragColor;

  // Фрагментный шейдер
  in vec3 fragColor;
  ```

---

### Работа с текстурами

- Текстуры передаются в шейдер с использованием переменных типа `sampler2D`, `samplerCube`, и т.д.
- Эти переменные работают в паре с `glActiveTexture` и `glUniform1i`, чтобы привязать текстуру к нужному юниту.
- Чтение из текстуры:

  ```glsl
  vec4 texColor = texture(mySampler, texCoords);
  ```

---

### Примеры шейдеров

- **Окружность*- — использование `uniform` для задания центра, радиуса и цвета.
- **Анимация*- — `uniform float time;`, изменение позиции по синусоиде.
- **Планета с текстурами*- — применение `sampler2D` для карты поверхности и облаков.
- **Пользовательские атрибуты*- — передача нормалей, текстурных координат, использование `varying`/`in-out`.

---

### Язык шейдеров GLSL

- Язык GLSL (OpenGL Shading Language):

  - синтаксис похож на C,
  - встроенные типы: `vec2`, `vec3`, `vec4`, `mat4`, и др.,
  - ключевые слова: `uniform`, `in`, `out`, `sampler*`, `discard`,
  - поддержка циклов, условий, пользовательских функций,
  - нет указателей, ссылок и строк,
  - строгая типизация и явные преобразования типов,
  - поддержка конструкторов (`vec3(1.0, 0.5, 0.2)`).

---

### Особенности и ограничения GLSL

- **Строгая типизация**: запрещены неявные преобразования (например, `int → float`).
- **Нет поддержки строк и указателей**, но доступны массивы и структуры.
- **Конструкторы и перегрузка функций*- поддерживаются.
- **Использование `discard`*- — позволяет отбросить фрагмент (например, в шейдере прозрачности).
- **Циклы и условия**: возможны, но стоит избегать сложных конструкций в старых GPU.

---

### Заключение

Лекция охватывает практические аспекты передачи параметров в шейдеры при программировании с использованием OpenGL, включая:

- передачу данных через `uniform`, `in`, `sampler`,
- передачу межшейдерных значений через `in`/`out`,
- применение этих механизмов в задачах рендеринга и анимации,
- обзор синтаксиса и особенностей языка GLSL.

Это позволяет студентам глубже понять, как осуществляется управление графикой на уровне вершин и фрагментов,
и как программно реализуются визуальные эффекты с помощью шейдеров.
